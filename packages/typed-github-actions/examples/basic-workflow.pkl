/// Basic GitHub Actions Workflow Example
///
/// This example demonstrates a simple build workflow that:
/// - Runs on push to main branch and pull requests
/// - Checks out the code
/// - Sets up Node.js
/// - Installs dependencies and builds the project
///
/// To use this example:
/// 1. Render to YAML: pkl eval -f yaml basic-workflow.pkl > .github/workflows/ci.yml
/// 2. Commit the generated workflow file to your repository
module basic.workflow

output {
  renderer = new YamlRenderer {}
}

name = "CI"

on {
  push {
    branches {
      "main"
    }
  }
  pull_request {
    branches {
      "main"
    }
  }
}

jobs {
  ["build"] {
    name = "Build"
    `runs-on` = "ubuntu-latest"
    
    steps {
      new {
        name = "Checkout code"
        uses = "actions/checkout@v4"
      }
      
      new {
        name = "Setup Node.js"
        uses = "actions/setup-node@v4"
        with {
          ["node-version"] = "20"
          ["cache"] = "npm"
        }
      }
      
      new {
        name = "Install dependencies"
        run = "npm ci"
      }
      
      new {
        name = "Build project"
        run = "npm run build"
      }
      
      new {
        name = "Upload build artifacts"
        uses = "actions/upload-artifact@v3"
        with {
          ["name"] = "build"
          ["path"] = "dist/"
        }
      }
    }
  }
}
